#!/bin/bash

set -e

chown -R cif:cif /var/lib/cif
chown -R cif:cif /var/log/cif
chown -R cif:cif /var/lib/fm
chown -R cif:cif /etc/cif
chown -R cif:cif /home/cif

chmod -R 660 /etc/cif/rules
chmod 770 /etc/cif/rules
chmod 770 /etc/cif/rules/default

if [[ ! -z "${MAXMIND_USER_ID}" ]]; then
    echo "UserId ${MAXMIND_USER_ID}" > /etc/GeoIP.conf
    echo "LicenseKey ${MAXMIND_LICENSE_KEY}" >> /etc/GeoIP.conf
    echo "ProductIds GeoLite2-ASN GeoLite2-City GeoLite2-Country" >> /etc/GeoIP.conf
    geoipupdate -v
fi

/etc/init.d/cron start
/etc/init.d/bind9 start

/usr/local/bin/supervisord -n -c /usr/local/etc/supervisord.conf